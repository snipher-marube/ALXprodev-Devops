#!/bin/bash

# Output CSV file
report_file="pokemon_report.csv"
timestamp=$(date +"%Y-%m-%d %H:%M:%S")

# Initialize CSV header
echo "Name,Height (m),Weight (kg)" > "$report_file"

# Temporary file for calculations
temp_file=$(mktemp)

# Process each PokÃ©mon JSON file
for file in pokemon_data/*.json; do
    # Extract data using jq
    name=$(jq -r '.name' "$file")
    height=$(jq -r '.height/10' "$file")
    weight=$(jq -r '.weight/10' "$file")
    
    # Add to CSV
    echo "$name,$height,$weight" >> "$report_file"
    
    # Store values for averages
    echo "$height $weight" >> "$temp_file"
done

# Calculate averages using awk
averages=$(awk '
{
    height_sum += $1
    weight_sum += $2
    count++
}
END {
    printf "%.2f %.2f", height_sum/count, weight_sum/count
}' "$temp_file")

# Clean up temp file
rm "$temp_file"

# Print report summary
echo "CSV Report generated at: $report_file"
echo
cat "$report_file"
echo
echo "Average Height: $(echo "$averages" | cut -d' ' -f1) m"
echo "Average Weight: $(echo "$averages" | cut -d' ' -f2) kg"